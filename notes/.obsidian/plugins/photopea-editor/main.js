/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var c=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var d=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var m=(a,e)=>{for(var t in e)c(a,t,{get:e[t],enumerable:!0})},f=(a,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of d(e))!g.call(a,o)&&o!==t&&c(a,o,{get:()=>e[o],enumerable:!(n=h(e,o))||n.enumerable});return a};var w=a=>f(c({},"__esModule",{value:!0}),a);var I={};m(I,{default:()=>r});module.exports=w(I);var p=require("obsidian"),r=class extends p.Plugin{async onload(){this.registerEvent(this.app.workspace.on("file-open",e=>{e instanceof p.TFile&&this.openImageInPhotopea(e)}))}async openImageInPhotopea(e){let t=e.extension.toLowerCase();if(t==="png"||t==="jpg"||t==="jpeg"){let o={files:[await this.convertFileToDataURI(e)],script:"app.echoToOE('Hello from Obsidian!');"},s=`https://www.photopea.com#${encodeURIComponent(JSON.stringify(o))}`,i=this.app.workspace.activeLeaf;i&&this.replaceImageWithPhotopea(i,s)}}replaceImageWithPhotopea(e,t){let{view:n}=e;if(n.getViewType()==="image"){let o=n.containerEl;o.empty();let s=o.createEl("iframe",{attr:{src:t,width:"100%",height:"100%",frameborder:"0"}});s.style.border="none"}}onClose(){}async convertFileToDataURI(e){return new Promise((t,n)=>{this.app.vault.readBinary(e).then(o=>{let s=new Blob([o],{type:`image/${e.extension}`}),i=new FileReader;i.onloadend=()=>{let l=i.result;t(l)},i.onerror=n,i.readAsDataURL(s)})})}};

/* nosourcemap */